<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<%= javascript_include_tag 'application' %>

<h4 class="top-margin-map-sap" >My Places</h4>

<!--style to fix google map zoom display-->
<style>
	.gm-style img { max-width: none; }
	.gm-style label { width: auto; display: inline; }
</style>

<div class="map_container">
      <div id="currentplusfavs" class="map_canvas" style='width: 100%; height: 800px;'></div>
</div>

<script type="text/javascript">

	var handler = Gmaps.build('Google');
	handler.buildMap({
						internal: {id: 'currentplusfavs'}
					},
					function(){
		if(navigator.geolocation)
			navigator.geolocation.getCurrentPosition(displayOnMap);
	});

	function displayOnMap(position){
		var marker = handler.addMarker({  // add current location pin
			lat: position.coords.latitude,
			lng: position.coords.longitude,
			picture: {
				url: "https://sparecube.com/public/img/user-loc-btn.png",
				width:  36,
				height: 36
			}
		});
		// add pins for my save places
		markers = handler.addMarkers(<%=raw @my_places_hash.to_json %>);
		// display map
		handler.map.centerOn(marker);
		handler.getMap().setZoom(10);
		google.maps.event.trigger(map, "resize");
	};
</script>









